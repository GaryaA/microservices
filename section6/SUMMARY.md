# Summary: Section 6 - Configurations Management in Microservices

## Обзор секции

В шестой секции курса изучалось управление конфигурациями в микросервисной архитектуре. Были рассмотрены различные подходы к управлению конфигурациями: от простых профилей Spring Boot до централизованного управления через Spring Cloud Config Server.

## Что было изучено

### 1. Проблемы управления конфигурациями
- Распределение конфигураций по множеству микросервисов
- Необходимость обновления конфигураций без перезапуска
- Управление конфигурациями для разных окружений (dev, qa, prod)
- Безопасность чувствительных данных (пароли, ключи)

### 2. Spring Boot Profiles
- Использование профилей для разных окружений
- Файлы конфигурации: `application.yml`, `application-qa.yml`, `application-prod.yml`
- Активация профилей через `spring.profiles.active`
- Преимущества и ограничения подхода

### 3. Spring Cloud Config Server
- Централизованное управление конфигурациями
- Архитектура Config Server:
  - Config Server как отдельный микросервис
  - Хранение конфигураций в Git репозитории
  - Клиенты получают конфигурации через HTTP
- Преимущества:
  - Единая точка управления
  - Версионирование через Git
  - Динамическое обновление конфигураций

### 4. Настройка Config Server
- Зависимость `spring-cloud-config-server`
- Аннотация `@EnableConfigServer`
- Конфигурация Git репозитория:
  - URI репозитория
  - Ветка по умолчанию
  - Таймауты и настройки клонирования
- Режимы работы:
  - Native mode (локальные файлы)
  - Git mode (удаленный репозиторий)

### 5. Config Client в микросервисах
- Зависимость `spring-cloud-starter-config`
- Настройка через `spring.config.import`
- Формат: `configserver:http://localhost:8071/`
- Именование конфигураций:
  - `{application}-{profile}.yml`
  - Пример: `accounts-prod.yml`, `cards-qa.yml`

### 6. Spring Cloud Bus
- Распространение изменений конфигураций
- Интеграция с RabbitMQ
- Автоматическое обновление всех микросервисов при изменении конфигурации
- Endpoint `/actuator/busrefresh` для обновления

### 7. Шифрование конфигураций
- Защита чувствительных данных
- Использование симметричного шифрования
- Настройка ключа шифрования
- Формат зашифрованных значений: `{cipher}...`

### 8. Версионирование конфигураций
- Использование Git для версионирования
- Откат к предыдущим версиям
- Тегирование версий конфигураций
- История изменений

## Что было реализовано

### Config Server
- **Порт**: 8071
- **Хранение**: Git репозиторий (https://github.com/eazybytes/eazybytes-config.git)
- **Функциональность**:
  - Предоставление конфигураций через REST API
  - Поддержка профилей
  - Шифрование чувствительных данных
  - Интеграция с Spring Cloud Bus

### Структура конфигураций
- `accounts.yml` - базовая конфигурация
- `accounts-qa.yml` - конфигурация для QA окружения
- `accounts-prod.yml` - конфигурация для production
- Аналогично для cards и loans сервисов

### Интеграция микросервисов
- Все микросервисы настроены как Config Clients
- Автоматическое получение конфигураций при старте
- Поддержка динамического обновления через Bus

## Технические детали

### Зависимости
- `spring-cloud-config-server` - для сервера
- `spring-cloud-starter-config` - для клиентов
- `spring-cloud-starter-bus-amqp` - для распространения изменений
- `spring-cloud-config-monitor` - для мониторинга изменений

### Endpoints Config Server
- `GET /{application}/{profile}` - получение конфигурации
- `GET /{application}/{profile}/{label}` - получение с указанием ветки
- `/actuator/busrefresh` - обновление через Bus

### Формат конфигураций
- YAML формат для читаемости
- Поддержка вложенных структур
- Переменные окружения

## Best Practices

1. **Централизация конфигураций** - единая точка управления
2. **Версионирование** - использование Git для отслеживания изменений
3. **Шифрование** - защита чувствительных данных
4. **Профили** - разделение по окружениям
5. **Динамическое обновление** - использование Spring Cloud Bus
6. **Fallback значения** - значения по умолчанию в application.yml

## Результаты секции

После завершения шестой секции студенты:
1. Понимают проблемы управления конфигурациями в микросервисах
2. Умеют настраивать Spring Cloud Config Server
3. Знают, как интегрировать Config Client в микросервисы
4. Умеют использовать Spring Cloud Bus для обновления конфигураций
5. Понимают важность шифрования чувствительных данных
6. Знают best practices для управления конфигурациями

## Следующие шаги

В следующих секциях курса будут изучены:
- Использование production баз данных (Section 7)
- Service Discovery (Section 8)
- API Gateway (Section 9)
- Устойчивость микросервисов (Section 10)

