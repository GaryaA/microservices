# Summary: Section 7 - Using MySQL DBs inside Microservices

## Обзор секции

В седьмой секции курса изучалась интеграция production баз данных MySQL в микросервисы. Была рассмотрена замена in-memory H2 базы данных на полноценные MySQL контейнеры и настройка подключений.

## Что было изучено

### 1. Переход от H2 к MySQL
- Ограничения H2 для production окружений
- Преимущества MySQL:
  - Надежность и стабильность
  - Поддержка транзакций
  - Масштабируемость
  - Production-ready возможности

### 2. Docker контейнеры для MySQL
- Использование официального MySQL образа
- Настройка контейнеров через Docker Compose
- Изоляция баз данных для каждого микросервиса:
  - `accountsdb` - база данных для Accounts сервиса
  - `cardsdb` - база данных для Cards сервиса
  - `loansdb` - база данных для Loans сервиса

### 3. Конфигурация подключений
- Настройка JDBC URL для подключения к MySQL
- Параметры подключения:
  - Host и порт
  - Имя базы данных
  - Учетные данные (username, password)
- Использование переменных окружения

### 4. Управление схемой базы данных
- SQL скрипты для создания схемы (`schema.sql`)
- Автоматическое выполнение при старте приложения
- Миграции через JPA `ddl-auto`
- Поддержка существующих данных

### 5. Изоляция данных
- Принцип "Database per Service"
- Каждый микросервис имеет свою базу данных
- Независимое масштабирование
- Изоляция сбоев

### 6. Health Checks
- Проверка готовности базы данных
- Health check endpoints для контейнеров
- Зависимости между сервисами в Docker Compose

### 7. Управление версиями схемы
- Версионирование SQL скриптов
- Миграции при обновлении приложения
- Обратная совместимость

## Что было реализовано

### MySQL контейнеры в Docker Compose
- **accountsdb**: порт 3306, база `accountsdb`
- **loansdb**: порт 3307, база `loansdb`
- **cardsdb**: порт 3308, база `cardsdb`
- Каждый контейнер изолирован и имеет свою базу данных

### Конфигурация подключений
```yaml
spring:
  datasource:
    url: jdbc:mysql://accountsdb:3306/accountsdb
    driverClassName: com.mysql.cj.jdbc.Driver
    username: root
    password: root
```

### Интеграция с Config Server
- Конфигурации баз данных хранятся в Config Server
- Разные настройки для разных окружений
- Централизованное управление подключениями

## Технические детали

### Зависимости
- `mysql-connector-java` или `mysql-connector-j` - драйвер MySQL
- Spring Data JPA для работы с базой данных
- Hibernate как JPA провайдер

### Docker Compose конфигурация
- Использование `extends` для переиспользования конфигураций
- Health checks для проверки готовности
- Порты для доступа к базам данных

### Миграции схемы
- SQL скрипты в `src/main/resources/schema.sql`
- Автоматическое выполнение при старте
- Поддержка существующих таблиц через `IF NOT EXISTS`

## Best Practices

1. **Database per Service** - изоляция данных каждого микросервиса
2. **Версионирование схемы** - отслеживание изменений структуры БД
3. **Health Checks** - мониторинг состояния баз данных
4. **Безопасность** - использование переменных окружения для паролей
5. **Резервное копирование** - регулярные бэкапы production баз данных
6. **Мониторинг** - отслеживание производительности запросов

## Результаты секции

После завершения седьмой секции студенты:
1. Понимают важность использования production баз данных
2. Умеют настраивать MySQL контейнеры в Docker
3. Знают, как конфигурировать подключения к MySQL в Spring Boot
4. Понимают принцип "Database per Service"
5. Умеют управлять схемой базы данных
6. Знают best practices для работы с базами данных в микросервисах

## Следующие шаги

В следующих секциях курса будут изучены:
- Service Discovery и Service Registration (Section 8)
- API Gateway и маршрутизация (Section 9)
- Устойчивость микросервисов (Section 10)
- Мониторинг и observability (Section 11)

